{
  "hash": "e3a51c8dd449744010b08d1bb472d775",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"AE 02: Multiple linear regression\"\nsubtitle: \"Peer-to-peer lending\"\ndate: \"Sep 12, 2024\"\neditor: visual\n---\n\n\n\n::: callout-important\nGo to the [course GitHub organization](https://github.com/sta221-fa24) and locate your `ae-02` repo to get started.\n\nRender, commit, and push your responses to GitHub by the end of class to submit your AE.\n:::\n\n# Packages\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)   \nlibrary(tidymodels)   \nlibrary(openintro)    \nlibrary(knitr)       \n```\n:::\n\n\n\n# Data\n\nToday's data is a sample of 50 loans made through a peer-to-peer lending club. The data is in the `loan50` data frame in the **openintro** R package.\n\nWe will focus on the following variables:\n\n-   `annual_income_th`: Annual income (in \\$1000s)\n-   `debt_to_income`: Debt-to-income ratio, i.e. the percentage of a borrower's total debt divided by their total income\n-   `verified_income`: Whether borrower's income source and amount have been verified (`Not Verified`, `Source Verified`, `Verified`)\n-   `interest_rate`: Interest rate for the loan\n\nThe goal of this analysis is to use the annual income, debt-to-income ratio, and income verification to understand variability in the interest rate on the loan.\n\nWe'll start with data prep to rescale annual income to \\$1000's and recode `verified_income` to fix an issue with the underlying data.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nloan50 <- loan50 |>\n   mutate(annual_income_th = annual_income / 1000, \n          verified_income = \n            case_when(verified_income == \"Not Verified\" ~ \"Not Verified\",\n                      verified_income == \"Source Verified\" ~ \"Source Verified\",\n                      verified_income == \"Verified\" ~ \"Verified\"),\n          verified_income = as_factor(verified_income)\n   )                    \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(loan50)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 50\nColumns: 19\n$ state                   <fct> NJ, CA, SC, CA, OH, IN, NY, MO, FL, FL, MD, HIâ€¦\n$ emp_length              <dbl> 3, 10, NA, 0, 4, 6, 2, 10, 6, 3, 8, 10, 10, 2,â€¦\n$ term                    <dbl> 60, 36, 36, 36, 60, 36, 36, 36, 60, 60, 36, 36â€¦\n$ homeownership           <fct> rent, rent, mortgage, rent, mortgage, mortgageâ€¦\n$ annual_income           <dbl> 59000, 60000, 75000, 75000, 254000, 67000, 288â€¦\n$ verified_income         <fct> Not Verified, Not Verified, Verified, Not Veriâ€¦\n$ debt_to_income          <dbl> 0.55752542, 1.30568333, 1.05628000, 0.57434667â€¦\n$ total_credit_limit      <int> 95131, 51929, 301373, 59890, 422619, 349825, 1â€¦\n$ total_credit_utilized   <int> 32894, 78341, 79221, 43076, 60490, 72162, 2872â€¦\n$ num_cc_carrying_balance <int> 8, 2, 14, 10, 2, 4, 1, 3, 10, 4, 3, 4, 3, 2, 3â€¦\n$ loan_purpose            <fct> debt_consolidation, credit_card, debt_consolidâ€¦\n$ loan_amount             <int> 22000, 6000, 25000, 6000, 25000, 6400, 3000, 1â€¦\n$ grade                   <fct> B, B, E, B, B, B, D, A, A, C, D, A, A, A, A, Eâ€¦\n$ interest_rate           <dbl> 10.90, 9.92, 26.30, 9.92, 9.43, 9.92, 17.09, 6â€¦\n$ public_record_bankrupt  <int> 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0â€¦\n$ loan_status             <fct> Current, Current, Current, Current, Current, Câ€¦\n$ has_second_income       <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSâ€¦\n$ total_income            <dbl> 59000, 60000, 75000, 75000, 254000, 67000, 288â€¦\n$ annual_income_th        <dbl> 59.0, 60.0, 75.0, 75.0, 254.0, 67.0, 28.8, 80.â€¦\n```\n\n\n:::\n:::\n\n\n\n# Categorical predictors\n\n::: callout-note\n## Exercise 1\n\nLet's take a look at the design matrix for the model with predictors `debt_to_income`, `annual_income_th`, and `verified_income`.\n\nHow does R choose the baseline level by default?\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## add code here\n```\n:::\n\n\n\n\\[Add response here\\]\n\n::: callout-note\n## Exercise 2\n\nFit the model with the predictors `debt_to_income`, `annual_income_th`, `verified_income` , and the interaction between `annual_income_th` and `verified_income`.\n\nNeatly display the model results using 3 digits.\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add code here\n```\n:::\n\n\n\n::: callout-note\n## Exercise 3\n\n-   Write the estimated regression equation for the people with `Not Verified` income.\n\n-   Write the estimated regression equation for people with `Verified` income.\n:::\n\n\\[add response here\\]\n\n::: callout-note\n## Exercise 4\n\nIn general, how do\n\n-   indicators for categorical predictors impact the model equation?\n\n-   interaction terms impact the model equation?\n:::\n\n\\[Add response here\\]\n\n# Model assessment\n\n::: callout-note\n## Exercise 5\n\nLet's compare the original model without interaction effects to the model you fit in Exercise 2.\n\nCalculate $R^2$ and $Adj. R^2$ for each model. You can find $Adj. R^2$ from the `glance` function:\n\n`glance(model_name)$adj.r.squared`\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nint_fit <- lm(interest_rate ~ debt_to_income + annual_income_th +\n                verified_income, data = loan50)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# add code here\n```\n:::\n\n\n\n::: callout-note\n## Exercise 6\n\nWhich model would you choose based on\n\n-   $R^2$?\n\n-   $Adj. R^2$?\n:::\n\n\\[add response here\\]\n\n# LaTex\n\nSometimes, you will need to include mathematical notation in your document. There are two ways you can display mathematics in your document:\n\n**Inline:** Your mathematics will display within the line of text.\n\n-   Use `$` to start and end your LaTex syntax. You can also use the menu: *Insert -\\> LaTex Math -\\> Inline Math*.\n\n-   *Example*: The text `The simple linear regression model is $\\mathbf{y} = \\mathbf{X}\\boldsymbol{\\beta} + \\boldsymbol{\\epsilon}$` produces\\\n\n    The simple linear regression model is $\\mathbf{y} = \\mathbf{X}\\boldsymbol{\\beta} + \\boldsymbol{\\epsilon}$\n\n\\\n**Displayed:** Your mathematics will display outside the line of text\n\n-   Use a `$$` to start and end your LaTex syntax. You can also use the menu: *Insert -\\> LaTex Math -\\> Display Math*.\n\n-   *Example*: The text `The estimated regression equation is $$\\hat{\\mathbf{y}} = \\mathbf{X}\\hat{\\boldsymbol{\\beta}}$$`produces\\\n\n    The estimated regression equation is\n\n$$\n\\hat{\\mathbf{y}} = \\mathbf{X}\\hat{\\boldsymbol{\\beta}}\n$$\n\n::: callout-tip\n[Click here](https://oeis.org/wiki/List_of_LaTeX_mathematical_symbols) for a quick reference of LaTex code.\n:::\n\n# Submission\n\n::: callout-important\nTo submit the AE:\n\n-   Render the document to produce the PDF with all of your work from today's class.\n-   Push all your work to your AE repo on GitHub. You're done! ðŸŽ‰\n:::\n",
    "supporting": [
      "ae-02-mlr_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}