{
  "hash": "b6389cbae6be8e0a64e66b3a72b63198",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Variance Inflation Factors\"\nformat: html\nbibliography: references.bib\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n# load packages\nlibrary(tidyverse)  \nlibrary(tidymodels)  \nlibrary(knitr)       \n\nrail_trail <- read_csv(\"data/rail_trail.csv\")\n```\n:::\n\n\n\n\nHere we explain the connection between the Variance Inflation Factor (VIF) and $\\mathbf{C} = (\\mathbf{X}^\\mathsf{T}\\mathbf{X})^{-1}$. This explanation is motivated by Chapter 3 of @montgomery2021introduction.\n\n## Unit length scaling\n\nWe have talked about standardizing predictors, such that \n\n$$x_{ij_{std}} = \\frac{x_{ij} - \\bar{x_j}}{s_{x_{j}}}$$ such that $\\bar{x}_j$ is the mean  and $s_{x_{j}}$ is the standard deviation of the predictor $x_j$. \n\nThe standardized predictors have a mean of 0 and variance of 1.\n\nAnother common type of scaling is **unit length scaling**. We will denote these scaled predictors as $w_j$.  We apply this scaling on both the predictor and response variable in the following way. \n\n$$w_{ij} = \\frac{x_{ij} - \\bar{x_j}}{\\sqrt{s_{jj}}}$$ \nwhere $s_{jj} = \\sum_{i = 1}^{n}(x_{ij} - \\bar{x}_j)^2$ \n\nThe scaled response variable, denoted $y^0$ is \n\n$$y_i^0 = \\frac{y_i - \\bar{y}}{\\sqrt{SST}}$$\n\nwhere $SST$ is the sum of squares total, $\\sum_{i=1}^n(y_i - \\bar{y})^2$ \n\nWe will use the scaled predictor and response variable to show the relationship between $\\mathbf{C} = (\\mathbf{X}^\\mathsf{T}\\mathbf{X})^{-1}$  and the formula for VIF. More specifically, that\n\n$$\nC_{jj} = VIF_{j} = \\frac{1}{1 - R^2_j}\n$$\n\nWhen we use the scaled predictors and response. \n\n## Variance inflation factor\n\nWe will use the `rail_trail` data from the notes to illustrate this connection. We will focus on the predictors `hightemp`, `avgtemp`, and `precip`. \n\nWe begin by creating unit length scaled versions of the variables. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhightemp_norm <- sum((rail_trail$hightemp - mean(rail_trail$hightemp))^2)\navgtemp_norm <- sum((rail_trail$avgtemp - mean(rail_trail$avgtemp))^2)\nprecip_norm <- sum((rail_trail$precip - mean(rail_trail$precip))^2)\nvolume_norm <- sum((rail_trail$volume - mean(rail_trail$volume))^2)\n\nrail_trail <- rail_trail |>\n  mutate(hightemp_scaled = (hightemp - mean(hightemp)) / hightemp_norm^.5,\n         avgtemp_scaled = (avgtemp - mean(avgtemp)) / avgtemp_norm^.5, \n         precip_scaled = (precip - mean(precip)) / precip_norm^.5,\n         volume_scaled = (volume - mean(volume)) / volume_norm^.5\n         )\n```\n:::\n\n\n\nThe matrix $\\mathbf{W}^\\mathsf{T}\\mathbf{W}$ is equivalent to the correlation matrix for these predictors. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# use -1 to remove the intercept for the correlation matrix\nW <- model.matrix(volume_scaled ~ hightemp_scaled + avgtemp_scaled + precip_scaled - 1, data = rail_trail)\n\nt(W)%*%W\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                hightemp_scaled avgtemp_scaled precip_scaled\nhightemp_scaled       1.0000000      0.9196439     0.1343172\navgtemp_scaled        0.9196439      1.0000000     0.2725832\nprecip_scaled         0.1343172      0.2725832     1.0000000\n```\n\n\n:::\n:::\n\n\n\nWhen we fit a model using the unit length scaling for the response and predictor variables, we would expect $Var(\\hat{\\beta}_j) / \\hat{\\sigma}^2_{\\epsilon} \\approx 1$. As we see below, however, these values are greater than 1. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrail_model_scaled <- lm(volume_scaled ~ hightemp_scaled + avgtemp_scaled + precip_scaled , data = rail_trail)\n\nbeta_se <- tidy(trail_model_scaled)$std.error\nsigma <- glance(trail_model_scaled)$sigma\n\nbeta_se^2 / sigma^2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.01111111 7.16188175 7.59715405 1.19343051\n```\n\n\n:::\n:::\n\n\n(You can ignore the first element, which represents the intercept). \n\n\nThese values show how much the standard errors of the coefficients are inflated given the correlation between the predictors (the off diagonal elements of $\\mathbf{W}^\\mathsf{T}\\mathbf{W}$). The amount by which the standard errors are inflated are called the **variance inflation factors (VIF)**. \n\nUnder this model using the unit-length-scaled predictors and response, we see these **variance inflation factors** are equal to the diagonal elements of $\\mathbf{C} = (\\mathbf{W}^\\mathsf{T}\\mathbf{W})^{1}$. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nC <- solve(t(W) %*% W)\ndiag(C)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nhightemp_scaled  avgtemp_scaled   precip_scaled \n       7.161882        7.597154        1.193431 \n```\n\n\n:::\n:::\n\n\n\nThus, \n\n$$C_{jj} = VIF_{j} = \\frac{1}{1 - R^2_j}$$\n\n## References\n\n\n",
    "supporting": [
      "variance-inflation-factors_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}