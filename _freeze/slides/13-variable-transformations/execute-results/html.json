{
  "hash": "d54a3775e44cacd6b6424149b1ca9284",
  "result": {
    "markdown": "---\ntitle: \"Variable transformations\"\nauthor: \"Prof. Maria Tackett\"\ndate: \"2022-10-12\"\ndate-format: \"MMM DD, YYYY\"\nfooter: \"[ðŸ”— Week 07](https://sta210-fa22.netlify.app/weeks/week-07.html)\"\nlogo: \"../images/logo.png\"\nformat: \n  revealjs:\n    theme: slides.scss\n    multiplex: false\n    transition: fade\n    slide-number: true\n    incremental: false \n    chalkboard: true\nexecute:\n  freeze: auto\n  echo: true\n  warning: false\n  message: false\nknitr:\n  opts_chunk: \n    R.options:      \n    width: 200\n---\n\n\n\n\n## Announcements\n\n-   [Click here](https://duke.qualtrics.com/jfe/form/SV_cwh38yvzlVjWvA2) to fill out mid-semester survey by Friday.\n-   Lab 04 due:\n    -   Thu, Oct 13, 11:59pm (Thu labs)\n    -   Fri, Oct 14, 11:59pm (Fri labs)\n-   HW 02 due Wed, Oct 19, 11:59pm (released later today)\n-   Office hours resume tomorrow (Thursday)\n-   Click here for [Week 07](../weeks/week-07.qmd) activities.\n\n## Topics\n\n-   Log transformation on the response variable\n\n-   Log transformation on the predictor variable\n\n## Computational set up\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(knitr)\nlibrary(Sleuth3) \nlibrary(patchwork)\n\n# set default theme and larger font size for ggplot2\nggplot2::theme_set(ggplot2::theme_bw(base_size = 20))\n```\n:::\n\n\n## Respiratory Rate vs. Age {.midi}\n\n-   A high respiratory rate can potentially indicate a respiratory infection in children. In order to determine what indicates a \"high\" rate, we first want to understand the relationship between a child's age and their respiratory rate.\n\n-   The data contain the respiratory rate for 618 children ages 15 days to 3 years. It was obtained from the **Sleuth3** R package and is originally form a 1994 publication \"Reference Values for Respiratory Rate in the First 3 Years of Life\".\n\n-   **Variables**:\n\n    -   `Age`: age in months\n    -   `Rate`: respiratory rate (breaths per minute)\n\n## Rate vs. Age\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](13-variable-transformations_files/figure-revealjs/unnamed-chunk-3-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\n::: question\nWhat do you notice in this plot?\n:::\n\n## Training + test sets\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nset.seed(101222)\n# iniital split \nresp_split <- initial_split(respiratory)\n\n# training set\nresp_train <- training(resp_split)\n\n# test set\nresp_test <- testing(resp_split)\n```\n:::\n\n\n## Model 1: Rate vs. Age\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nresp_fit <- linear_reg() |>\n  set_engine(\"lm\") |>\n  fit(Rate ~ Age, data = resp_train)\n\ntidy(resp_fit) |>\n  kable(digits = 3)\n```\n\n::: {.cell-output-display}\n|term        | estimate| std.error| statistic| p.value|\n|:-----------|--------:|---------:|---------:|-------:|\n|(Intercept) |   46.458|     0.589|    78.924|       0|\n|Age         |   -0.659|     0.034|   -19.498|       0|\n:::\n:::\n\n\n## Model 1: Residuals\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](13-variable-transformations_files/figure-revealjs/unnamed-chunk-6-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\n::: question\nWhat do you notice in this plot?\n:::\n\n## Consider different transformations...\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](13-variable-transformations_files/figure-revealjs/unnamed-chunk-7-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\n# Log transformation on the response variable\n\n## Identifying a need to transform $Y$ {.midi}\n\n-   Typically, a \"fan-shaped\" residual plot indicates the need for a transformation of the response variable $Y$\n    -   There are multiple ways to transform a variable, e.g., $\\sqrt{Y}$, $1/Y$, $\\log(Y)$.\n    -   $\\log(Y)$ the most straightforward to interpret, so we use that transformation when possible\n\n. . .\n\n-   When building a model:\n    -   Choose a transformation and build the model on the transformed data\n    -   Reassess the residual plots\n    -   If the residuals plots did not sufficiently improve, try a new transformation!\n\n## Log transformation on $Y$\n\n-   If we apply a log transformation to the response variable, we want to estimate the parameters for the statistical model\n\n\n$$\n\\log(Y) = \\beta_0+ \\beta_1 X + \\epsilon, \\hspace{10mm} \\epsilon \\sim N(0,\\sigma^2_\\epsilon)\n$$\n\n\n-   The regression equation is\n\n\n$$\\widehat{\\log(Y)} = \\hat{\\beta}_0+ \\hat{\\beta}_1 X$$\n\n\n## Log transformation on $Y$\n\nWe want to interpret the model in terms of the original variable $Y$, not $\\log(Y)$, so we need to write the model in terms of $Y$\n\n\n$$\\hat{Y} = \\exp\\{\\hat{\\beta}_0 + \\hat{\\beta}_1 X\\} = \\exp\\{\\hat{\\beta}_0\\}\\exp\\{\\hat{\\beta}_1X\\}$$<br>\\\n\n$$\\widehat{\\text{Median}({Y|X})} = \\exp\\{\\hat{\\beta}_0\\}\\exp\\{\\hat{\\beta}_1 X\\}$$\n\n\n## Model interpretation\n\n\n$$\\hat{Y} = \\exp\\{\\hat{\\beta}_0 + \\hat{\\beta}_1 X\\} = \\exp\\{\\hat{\\beta}_0\\}\\exp\\{\\hat{\\beta}_1X\\}$$\n\n\n. . .\n\n-   **Intercept**: When $X=0$, the median of $Y$ is expected to be $\\exp\\{\\hat{\\beta}_0\\}$\n\n-   **Slope:** For every one unit increase in $X$, the median of $Y$ is expected to multiply by a factor of $\\exp\\{\\hat{\\beta}_1\\}$\n\n::: question\nWhy is the interpretation in terms of a multiplicative change?\n:::\n\n## Why $Median(Y|X)$ instead of $\\mu_{Y|X}$\n\nSuppose we have a set of values\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nx <- c(3, 5, 6, 8, 10, 14, 19)\n```\n:::\n\n<br>\n\n. . .\n\n::: columns\n::: {.column width=\"50%\"}\nLet's calculate $\\overline{\\log(x)}$\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlog_x <- log(x)\nmean(log_x)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2.066476\n```\n:::\n:::\n:::\n\n::: {.column width=\"50%\"}\nLet's calculate $\\log(\\bar{x})$\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nxbar <- mean(x)\nlog(xbar)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2.228477\n```\n:::\n:::\n:::\n:::\n\n<br>\n\n. . .\n\nNote: $\\overline{\\log(x)} \\neq \\log(\\bar{x})$\n\n## Why $Median(Y|X)$ instead of $\\mu_{Y|X}$\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nx <- c(3, 5, 6, 8, 10, 14, 19)\n```\n:::\n\n<br>\n\n. . .\n\n::: columns\n::: {.column width=\"50%\"}\nLet's calculate $\\text{Median}(\\log(x))$\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlog_x <- log(x)\nmedian(log_x)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2.079442\n```\n:::\n:::\n:::\n\n::: {.column width=\"50%\"}\nLet's calculate $\\log(\\text{Median}(x))$\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmedian_x <- median(x)\nlog(median_x)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2.079442\n```\n:::\n:::\n:::\n:::\n\n<br>\n\n. . .\n\nNote: $\\text{Median}(\\log(x)) = \\log(\\text{Median}(x))$\n\n## Mean, Median, and log\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nx <- c(3, 5, 6, 8, 10, 14, 19)\n```\n:::\n\n\n$$\\overline{\\log(x)} \\neq \\log(\\bar{x})$$\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmean(log_x) == log(xbar)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] FALSE\n```\n:::\n:::\n\n. . .\n\n\n$$\\text{Median}(\\log(x)) = \\log(\\text{Median}(x))$$\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmedian(log_x) == log(median_x)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] TRUE\n```\n:::\n:::\n\n## Mean and median of $\\log(Y)$\n\n-   Recall that $Y = \\beta_0 + \\beta_1 X$ is the **mean** value of the response at the given value of the predictor $X$. This doesn't hold when we log-transform the response variable.\n\n-   Mathematically, the mean of the logged values is **not** necessarily equal to the log of the mean value. Therefore at a given value of $X$\n\n. . .\n\n$$\n\n\\begin{aligned}\\exp\\{\\text{Mean}(\\log(Y|X))\\} \\neq \\text{Mean}(Y|X) \\\\[5pt]\n\\Rightarrow \\exp\\{\\beta_0 + \\beta_1 X\\} \\neq \\text{Mean}(Y|X) \\end{aligned}\n\n$$\n\n## Mean and median of $\\log(y)$\n\n-   However, the median of the logged values **is** equal to the log of the median value. Therefore,\n\n\n$$\\exp\\{\\text{Median}(\\log(Y|X))\\} = \\text{Median}(Y|X)$$\n\n\n. . .\n\n-   If the distribution of $\\log(Y)$ is symmetric about the regression line, for a given value $X$, we can expect $Mean(Y)$ and $Median(Y)$ to be approximately equal.\n\n## Model 2: log(Rate) vs. Age\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n|term        | estimate| std.error| statistic| p.value|\n|:-----------|--------:|---------:|---------:|-------:|\n|(Intercept) |    3.831|     0.015|   259.086|       0|\n|Age         |   -0.018|     0.001|   -21.243|       0|\n:::\n:::\n\n<br>\n\n::: question\nInterpret the slope and intercept in the context of the data.\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n```{=html}\n<div class=\"countdown\" id=\"timer_6347471c\" style=\"right:0;bottom:0;\" data-warnwhen=\"0\">\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">04</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n:::\n:::\n\n## Model 2: Residuals\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](13-variable-transformations_files/figure-revealjs/unnamed-chunk-19-1.png){fig-align='center' width=90%}\n:::\n:::\n\n## Compare residual plots\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](13-variable-transformations_files/figure-revealjs/unnamed-chunk-20-1.png){fig-align='center' width=90%}\n:::\n:::\n\n# Log transformation on a predictor variable\n\n## Log Transformation on $X$\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](13-variable-transformations_files/figure-revealjs/unnamed-chunk-23-1.png){fig-align='center' width=90%}\n:::\n:::\n\nTry a transformation on $X$ if the scatterplot shows some curvature but the variance is constant for all values of $X$\n\n## Rate vs. log(Age)\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](13-variable-transformations_files/figure-revealjs/unnamed-chunk-24-1.png){fig-align='center' width=90%}\n:::\n:::\n\n## Model with Transformation on $X$ {.midi}\n\nSuppose we have the following regression equation:\n\n\n$$\\hat{Y} = \\hat{\\beta}_0 + \\hat{\\beta}_1 \\log(X)$$\n\n\n. . .\n\n-   **Intercept:** When $X = 1$ $(\\log(X) = 0)$, $Y$ is expected to be $\\hat{\\beta}_0$ (i.e. the mean of $Y$ is $\\hat{\\beta}_0$)\n\n-   **Slope:** When $X$ is multiplied by a factor of $\\mathbf{C}$, the mean of $Y$ is expected to increase by $\\boldsymbol{\\hat{\\beta}_1}\\mathbf{\\log(C)}$ units\n\n    -   **Example**: when $X$ is multiplied by a factor of 2, $Y$ is expected to increase by $\\boldsymbol{\\hat{\\beta}_1}\\mathbf{\\log(2)}$ units\n\n## Model 3: Rate vs. log(Age)\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n|term        | estimate| std.error| statistic| p.value|\n|:-----------|--------:|---------:|---------:|-------:|\n|(Intercept) |   49.397|     0.755|    65.436|       0|\n|log_age     |   -5.668|     0.311|   -18.248|       0|\n:::\n:::\n\n<br>\n\n::: question\nInterpret the slope and intercept in the context of the data.\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n```{=html}\n<div class=\"countdown\" id=\"timer_634749b2\" style=\"right:0;bottom:0;\" data-warnwhen=\"0\">\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">04</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n:::\n:::\n\n## Model 3: Residuals\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](13-variable-transformations_files/figure-revealjs/unnamed-chunk-27-1.png){fig-align='center' width=90%}\n:::\n:::\n\n## Choose a model\n\nRecall the goal of the analysis:\n\n*In order to determine what indicates a \"high\" rate, we first want to understand the relationship between a child's age and their respiratory rate.*\n\n<br>\n\n::: question\nWhich is the preferred metric to compare the models - $R^2$ or RMSE?\n:::\n\n## Compare models on testing data\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n| Rate vs. Age                                                            | log(Rate) vs. Age                                                           | Rate vs. log(Age)                                                      |\n|-------------------------------------------------------------------------|-----------------------------------------------------------------------------|------------------------------------------------------------------------|\n| 0.549 | 0.596 | 0.559 |\n\n<br>\n\n::: question\nWhich model would you choose?\n:::\n\n## Learn more\n\nSee [Log Transformations in Linear Regression](https://github.com/sta210-sp20/supplemental-notes/blob/master/log-transformations.pdf) for more details about interpreting regression models with log-transformed variables.\n",
    "supporting": [
      "13-variable-transformations_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/countdown-0.3.5/countdown.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/countdown-0.3.5/countdown.js\"></script>\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    function fireSlideChanged(previousSlide, currentSlide) {\n\n      // dispatch for htmlwidgets\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for reveal\n    if (window.Reveal) {\n      window.Reveal.addEventListener(\"slidechanged\", function(event) {\n        fireSlideChanged(event.previousSlide, event.currentSlide);\n      });\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}