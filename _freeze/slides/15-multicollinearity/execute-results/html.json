{
  "hash": "18be4fa66ef4d2fb861f7bae42b23c3a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Multicollinearity + Variable transformations\"\nauthor: \"Prof. Maria Tackett\"\ndate: \"2024-10-22\"\ndate-format: \"MMM DD, YYYY\"\nfooter: \"[ðŸ”— STA 221 - Fall 2024](https://sta221-fa24.netlify.app)\"\nlogo: \"../images/logo.png\"\nformat: \n  revealjs:\n    theme: slides.scss\n    multiplex: false\n    transition: fade\n    slide-number: true\n    incremental: false \n    chalkboard: true\n    include-before: [ '<script type=\"text/x-mathjax-config\">MathJax.Hub.Config({tex2jax: {enableAssistiveMml: false}});</script>']\nhtml-math-method:\n  method: mathjax\n  url: \"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"\nexecute:\n  freeze: auto\n  echo: true\nknitr:\n  opts_chunk: \n    R.options:      \n    width: 200\nfilters:\n  - parse-latex\nbibliography: references.bib\n---\n\n\n\n## Announcements\n\n-   Exam corrections (optional) due Thursday at 11:59pm [on Canvas](https://canvas.duke.edu/courses/38867/assignments/169519)\n\n-   Lab 04 due Thursday at 11:59pm\n\n-   Looking ahead\n\n    -   Project: Exploratory data analysis due October 31\n\n    -   Statistics experience due Tuesday, November 26\n\n## Spring 2025 statistics classes\n\n## Computing set up\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load packages\nlibrary(tidyverse)  \nlibrary(tidymodels)  \nlibrary(knitr)       \nlibrary(patchwork)\nlibrary(GGally) #for scatterplot matrix\n\n\n# set default theme in ggplot2\nggplot2::theme_set(ggplot2::theme_bw())\n```\n:::\n\n\n\n## Topics\n\n-   Multicollinearity\n\n    -   Definition\n\n    -   How it impacts the model\n\n    -   How to detect it\n\n    -   What to do about it\n\n-   Variable transformations\n\n## Data: `rail_trail` {.midi}\n\n-   The Pioneer Valley Planning Commission (PVPC) collected data for ninety days from April 5, 2005 to November 15, 2005.\n-   Data collectors set up a laser sensor, with breaks in the laser beam recording when a rail-trail user passed the data collection station.\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 90 Ã— 7\n   volume hightemp avgtemp season cloudcover precip day_type\n    <dbl>    <dbl>   <dbl> <chr>       <dbl>  <dbl> <chr>   \n 1    501       83    66.5 Summer       7.60 0      Weekday \n 2    419       73    61   Summer       6.30 0.290  Weekday \n 3    397       74    63   Spring       7.5  0.320  Weekday \n 4    385       95    78   Summer       2.60 0      Weekend \n 5    200       44    48   Spring      10    0.140  Weekday \n 6    375       69    61.5 Spring       6.60 0.0200 Weekday \n 7    417       66    52.5 Spring       2.40 0      Weekday \n 8    629       66    52   Spring       0    0      Weekend \n 9    533       80    67.5 Summer       3.80 0      Weekend \n10    547       79    62   Summer       4.10 0      Weekday \n# â„¹ 80 more rows\n```\n\n\n:::\n:::\n\n\n\nSource: [Pioneer Valley Planning Commission](http://www.fvgreenway.org/pdfs/Northampton-Bikepath-Volume-Counts%20_05_LTA.pdf) via the **mosaicData** package.\n\n## Variables\n\n**Outcome**:\n\n`volume` estimated number of trail users that day (number of breaks recorded)\n\n**Predictors**\n\n-   `hightemp` daily high temperature (in degrees Fahrenheit)\n\n-   `avgtemp` average of daily low and daily high temperature (in degrees Fahrenheit)\n\n-   `season` one of â€œFallâ€, â€œSpringâ€, or â€œSummerâ€\n\n-   `precip` measure of precipitation (in inches)\n\n## EDA: Relationship between predictors\n\nWe can create a scatterplot matrix using the `ggpairs` function from the **GGally** R package\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrail_trail |>\n  select(hightemp, avgtemp, season, precip) |>\n  ggpairs()\n```\n:::\n\n\n\n## EDA: Relationship between predictors {.midi}\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](15-multicollinearity_files/figure-revealjs/unnamed-chunk-4-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n::: question\nWhat looks like a potential concern with a model that uses high temperature, average temperature, season, and precipitation to predict volume?\n:::\n\n# Multicollinearity\n\n## Multicollinearity\n\n-   Predictors are orthogonal when there is no linear relationship (dependence) between the predictors\n\n    -   This is generally not the case in practice but is often not a major issue\n\n-   **Multicollinearity**: there are near-linear dependencies between predictors\n\n## Common causes of multicollinearity\n\n-   Dependencies that generally occur in the population\n\n-   How the model is defined and the variables that are included\n\n-   Sample comes from only a subspace of the region of predictors\n\n-   There are more predictor variables than observations\n\n## Detecting multicollinearity\n\n-   **Variance Inflation Factor (VIF)**: Measure of multicollinearity in the regression model\n\n$$\nVIF_j = \\frac{1}{1 - R^2_j}\n$$\n\nwhere $R^2_j$ is the proportion of variation in $x_j$ that is explained by a linear combination of all the other predictors\n\n## Effects of multicollinearity\n\n-   Large variance $(\\hat{\\sigma}^2_{\\epsilon}(\\mathbf{X}^T\\mathbf{X})^{-1})$ in the model coefficients\n\n    -   Different combinations of coefficient estimates produce equally good model fits\n\n-   Unreliable statistical inference results\n\n    -   May conclude coefficients are not statistically significant when there is, in fact, a relationship\n\n-   Interpretation of coefficient is no longer while holding all other variables constant, since this would be impossible for correlated predictors\n\n## Detecting multicollinearity\n\n-   Common practice uses threshold $VIF > 10$ as indication of concerning multicollinearity\n\n-   Variables with similar values of VIF are typically the ones correlated with each other\n\n-   Use the `vif()` function in the **rms** R package to calculate VIF\n\n# Application exercise\n\n## Dealing with multicollinearity\n\n-   Collect more data\n\n    -   Often not feasible given practical constraints\n\n-   Respecify the correlated predictors to keep the information from predictors but eliminate collinearity\n\n    -   e.g., if $x_1, x_2, x_3$ are correlated, use a new variable $(x_1 + x_2) / x_3$ in the model\n\n-   For categorical predictors, avoid using levels with very few observations as the baseline\n\n-   Remove one of the correlated variables\n\n    -   Be careful about substantially reducing predictive power of the model\n\n# Application exercise\n\n# Variable transformations\n\n## Respiratory Rate vs. Age {.midi}\n\n-   A high respiratory rate can potentially indicate a respiratory infection in children. In order to determine what indicates a \"high\" rate, we first want to understand the relationship between a child's age and their respiratory rate.\n\n-   The data contain the respiratory rate for 618 children ages 15 days to 3 years. It was obtained from the **Sleuth3** R package and is originally form a 1994 publication \"Reference Values for Respiratory Rate in the First 3 Years of Life\".\n\n-   **Variables**:\n\n    -   `Age`: age in months\n    -   `Rate`: respiratory rate (breaths per minute)\n\n## Rate vs. Age\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](15-multicollinearity_files/figure-revealjs/unnamed-chunk-5-1.png){width=960}\n:::\n:::\n\n\n\n## Model 1: Rate vs. Age\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresp_fit <- lm(Rate ~ Age, data = respiratory)\n\ntidy(resp_fit) |>\n  kable(digits = 3)\n```\n\n::: {.cell-output-display}\n\n\n|term        | estimate| std.error| statistic| p.value|\n|:-----------|--------:|---------:|---------:|-------:|\n|(Intercept) |   47.052|     0.504|    93.317|       0|\n|Age         |   -0.696|     0.029|   -23.684|       0|\n\n\n:::\n:::\n\n\n\n## Model 1: Residuals\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](15-multicollinearity_files/figure-revealjs/unnamed-chunk-7-1.png){width=960}\n:::\n:::\n\n\n\n## Consider different transformations...\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](15-multicollinearity_files/figure-revealjs/unnamed-chunk-8-1.png){width=960}\n:::\n:::\n\n\n\n## Model 2: log(Rate) vs. Age\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|term        | estimate| std.error| statistic| p.value|\n|:-----------|--------:|---------:|---------:|-------:|\n|(Intercept) |    3.845|     0.013|   304.500|       0|\n|Age         |   -0.019|     0.001|   -25.839|       0|\n\n\n:::\n:::\n\n\n\n<br>\n\n-   **Slope:** For each additional month in a child's age, the median respiratory rate is expected to multiply by a factor of 0.982 \\[exp(-0.018)\\].\n\n-   **Intercept:** The median respiratory rate for children who are 0 months old is expected to be 29.4 \\[exp(3.381)\\].\n\n## Model 2: Residuals\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](15-multicollinearity_files/figure-revealjs/unnamed-chunk-10-1.png){width=960}\n:::\n:::\n\n\n\n## Compare residual plots\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](15-multicollinearity_files/figure-revealjs/unnamed-chunk-11-1.png){width=960}\n:::\n:::\n\n\n\n# Log transformation on a predictor variable\n\n## Log Transformation on $X$\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](15-multicollinearity_files/figure-revealjs/unnamed-chunk-14-1.png){width=960}\n:::\n:::\n\n\n\nTry a transformation on $X$ if the scatterplot shows some curvature but the variance is constant for all values of $X$\n\n## Rate vs. log(Age)\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](15-multicollinearity_files/figure-revealjs/unnamed-chunk-15-1.png){width=960}\n:::\n:::\n\n\n\n## Model with Transformation on $X$ {.midi}\n\nSuppose we have the following regression equation:\n\n$$\\hat{Y} = \\hat{\\beta}_0 + \\hat{\\beta}_1 \\log(X)$$\n\n. . .\n\n-   **Intercept:** When $X = 1$ $(\\log(X) = 0)$, $Y$ is expected to be $\\hat{\\beta}_0$ (i.e. the mean of $Y$ is $\\hat{\\beta}_0$)\n\n-   **Slope:** When $X$ is multiplied by a factor of $\\mathbf{C}$, the mean of $Y$ is expected to increase by $\\boldsymbol{\\hat{\\beta}_1}\\mathbf{\\log(C)}$ units\n\n    -   **Example**: when $X$ is multiplied by a factor of 2, $Y$ is expected to increase by $\\boldsymbol{\\hat{\\beta}_1}\\mathbf{\\log(2)}$ units\n\n## Model 3: Rate vs. log(Age)\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|term        | estimate| std.error| statistic| p.value|\n|:-----------|--------:|---------:|---------:|-------:|\n|(Intercept) |   50.135|     0.632|    79.330|       0|\n|log_age     |   -5.982|     0.263|   -22.781|       0|\n\n\n:::\n:::\n\n\n\n<br>\n\n::: question\nInterpret the slope and intercept in the context of the data.\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"countdown\" id=\"timer_24394772\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">04</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n\n:::\n:::\n\n\n\n## Model 3: Residuals\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](15-multicollinearity_files/figure-revealjs/unnamed-chunk-18-1.png){width=960}\n:::\n:::\n\n\n\n## Choose a model\n\nRecall the goal of the analysis:\n\n*In order to determine what indicates a \"high\" rate, we first want to understand the relationship between a child's age and their respiratory rate.*\n\n<br>\n\n::: question\nWhich is the preferred metric to compare the models - $R^2$ or RMSE?\n:::\n\n## Compare models\n\n\n\n::: {.cell}\n\n:::\n\n\n\n| Rate vs. Age                            | log(Rate) vs. Age                            | Rate vs. log(Age)                            |\n|------------------------|-------------------------|------------------------|\n| 0.477 | 0.52 | 0.457 |\n\n<br>\n\n::: question\nWhich model would you choose?\n:::\n\n## Learn more\n\nSee [Log Transformations in Linear Regression](https://github.com/sta210-sp20/supplemental-notes/blob/master/log-transformations.pdf) for more details about interpreting regression models with log-transformed variables.\n\n## Recap\n\n-   Introduced multicollinearity\n\n    -   Definition\n\n    -   How it impacts the model\n\n    -   How to detect it\n\n    -   What to do about it\n\n-   Introduced variable transformations\n",
    "supporting": [
      "15-multicollinearity_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/countdown-0.4.0/countdown.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/countdown-0.4.0/countdown.js\"></script>\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}