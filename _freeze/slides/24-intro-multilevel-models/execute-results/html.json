{
  "hash": "d5093f9cb46048144c49c61648d57499",
  "result": {
    "markdown": "---\ntitle: \"Introduction to multilevel models\"\nauthor: \"Prof. Maria Tackett\"\ndate: \"2022-11-28\"\ndate-format: \"MMM DD, YYYY\"\nfooter: \"[üîó Week 14](https://sta210-fa22.netlify.app/weeks/week-14.html)\"\nlogo: \"../images/logo.png\"\nformat: \n  revealjs:\n    theme: slides.scss\n    multiplex: false\n    transition: fade\n    slide-number: true\n    incremental: false \n    chalkboard: true\nexecute:\n  freeze: auto\n  echo: true\n  warning: false\n  message: false\nknitr:\n  opts_chunk: \n    R.options:      \n    width: 200\n---\n\n\n\n\n## Announcements\n\n-   Due dates\n\n    -   [Statistics experience](../hw/stats-experience.html) due Fri, Dec 09, 11:59pm\n\n-   Exam 02: Mon, Dec 05 (evening) - Thu, Dec 08, 12pm (noon)\n\n    -   Exam 02 review on Mon Dec 05\n\n    -   [Click here](https://duke.hosted.panopto.com/Panopto/Pages/Sessions/List.aspx?folderID=3abb0b6f-0db5-4d55-84f2-aefd0140874b) for lecture recordings - available until Dec 05, 11:59pm\n\n-   See [Week 14](../weeks/week-14.html) activities\n\n------------------------------------------------------------------------\n\n## Learning goals\n\n-   Recognize a potential for correlation in a data set\n-   Identify observational units at varying levels\n-   Understand issues correlated data may cause in modeling\n-   Understand how random effects models can be used to take correlation into account\n\n# Correlated observations\n\n## Examples of correlated data {.midi}\n\n::: incremental\n-   In an education study, scores for students from a particular teacher are typically more similar than scores of other students with a different teacher\n-   In a study measuring depression indices weekly over a month, the four measures for the same patient tend to be more similar than depression indices from other patients\n-   In political polling, opinions of members from the same household tend to be more similar than opinions of members from another household\n:::\n\n. . .\n\nCorrelation among outcomes within the same group (teacher, patient, household) is called **intraclass correlation**\n\n## Multilevel data {.midi}\n\n-   We can think of correlated data as having a multilevel structure\n\n    -   Population elements are aggregated into groups\n    -   There are observational units and measurements at each level\n\n. . .\n\n-   For now we will focus on data with two levels:\n\n    -   **Level one**: Most basic level of observation\n    -   **Level two**: Groups formed from aggregated level-one observations\n\n. . .\n\n-   Example: education\n    -   Level one: students in a class\n    -   Level two: class / teacher\n\n## Two types of effects\n\n::: incremental\n-   **Fixed effects**: Effects that are of interest in the study\n    -   Can think of these as effects whose interpretations would be included in a write up of the study\n-   **Random effects**: Effects we're not interested in studying but whose variability we want to understand\n    -   Can think of these as effects whose interpretations would not necessarily be included in a write up of the study\n:::\n\n## Example\n\nResearchers are interested in understanding the effect social media has on opinions about a proposed economic plan. They randomly select 1000 households. They ask each adult in the household how many minutes they spend on social media daily and whether they support the proposed economic plan.\n\n-   **Fixed effect**: daily minutes on social media\n-   **Random effect**: household\n\n## Practice {.midi}\n\nResearchers conducted a randomized controlled study where patients were randomly assigned to either an anti-epileptic drug or a placebo. For each patient, the number of seizures at baseline was measured over a 2-week period. For four consecutive visits the number of seizures were determined over the past 2-week period. Patient age and sex along with visit number were recorded.\n\n::: question\n1.  What are the level one and level two observational units?\n2.  What is the response variable?\n3.  Describe the within-group variation.\n4.  What are the fixed effects? What are the random effects?\n:::\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n```{=html}\n<div class=\"countdown\" id=\"timer_6384cf19\" style=\"right:0;bottom:0;\" data-warnwhen=\"0\">\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">03</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n:::\n:::\n\n\n# Multilevel models\n\n## Data: Music performance anxiety\n\nThe data [`musicdata.csv`](data/musicdata.csv) come from the Sadler and Miller (2010) study of the emotional state of musicians before performances. The dataset contains information collected from 37 undergraduate music majors who completed the Positive Affect Negative Affect Schedule (PANAS), an instrument produces a measure of anxiety (negative affect) and a measure of happiness (positive affect). This analysis will focus on negative affect as a measure of performance anxiety.\n\n## Data: Music performance anxiety\n\nThe primary variables we'll use are\n\n-   **`na`**: negative affect score on PANAS (the response variable)\n-   **`perform_type`**: type of performance (Solo, Large Ensemble, Small Ensemble)\n-   **`instrument`**: type of instrument (Voice, Orchestral, Piano)\n\n## Look at data {.midi}\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n| id| diary|perform_type   | na|gender |instrument |\n|--:|-----:|:--------------|--:|:------|:----------|\n|  1|     1|Solo           | 11|Female |voice      |\n|  1|     2|Large Ensemble | 19|Female |voice      |\n|  1|     3|Large Ensemble | 14|Female |voice      |\n| 43|     1|Solo           | 19|Female |voice      |\n| 43|     2|Solo           | 13|Female |voice      |\n| 43|     3|Small Ensemble | 19|Female |voice      |\n:::\n:::\n\n\n-   What are the Level One observations? Level Two observations?\n\n-   What are the Level One variables? Level Two variables?\n\n## Univariate exploratory data analysis\n\n**Level One variables**\n\nTwo ways to approach univariate EDA (visualizations and summary statistics) for Level One variables:\n\n-   Use individual observations (i.e., treat observations as independent)\n\n-   Use aggregated values for each Level Two observation\n\n. . .\n\n**Level Two variables**\n\n-   Use a data set that contains one row per Level Two observation\n\n## Bivariate exploratory data analysis {.midi}\n\n**Goals**\n\n-   Explore general association between the predictor and response variable\n-   Explore whether subjects at a given level of the predictor tend to have similar mean responses\n-   Explore whether variation in response differs at different levels of a predictor\n\nThere are two ways to visualize these associations:\n\n-   One plot of individual observations (i.e., treat observations as independent)\n\n-   Separate plots of responses vs. predictor for each Level Two observation (lattice plots)\n\n## Application exercise\n\n::: appex\nüìã [AE 15: Introduction to Multilevel models](../ae/ae-15-multilevel-models.html)\n:::\n\nComplete Part 2: Bivariate EDA\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n```{=html}\n<div class=\"countdown\" id=\"timer_6384cca2\" style=\"right:0;bottom:0;margin:1.25%;\" data-warnwhen=\"0\">\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">08</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n:::\n:::\n\n\n# Fitting the model\n\n## Questions we want to answer\n\nThe goal is to understand variability in performance anxiety (`na`) based on performance-level and musician-level characteristics.\n\nSpecifically:\n\n-   What is the association between performance type (large ensemble or not) and performance anxiety? Does the association differ based on instrument type (orchestral or not)?\n\n## Linear regression model\n\n::: question\nWhat is the problem with using the following model to draw conclusions?\n:::\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n|term                     | estimate| std.error| statistic| p.value|\n|:------------------------|--------:|---------:|---------:|-------:|\n|(Intercept)              |   15.721|     0.359|    43.778|   0.000|\n|orchestra                |    1.789|     0.552|     3.243|   0.001|\n|large_ensemble           |   -0.277|     0.791|    -0.350|   0.727|\n|orchestra:large_ensemble |   -1.709|     1.062|    -1.609|   0.108|\n:::\n:::\n\n\n------------------------------------------------------------------------\n\n## Other modeling approaches {.midi}\n\n1Ô∏è‚É£ Condense each musician's set of responses into a single outcome (e.g., mean max, last observation, etc.) and fit a linear model on these condensed observations\n\n-   Leaves few observations (37) to fit the model\n-   Ignoring a lot of information in the multiple observations for each musician\n\n. . .\n\n2Ô∏è‚É£ Fit a separate model for each musician understand the association between performance type (Level One models). Then fit a system of Level Two models to predict the fitted coefficients in the Level One model for each subject based on instrument type (Level Two model).\n\n. . .\n\n**Let's look at approach #2**\n\n## Level One model\n\nWe'll start with the Level One model to understand the association between performance type and performance anxiety for the $i^{th}$ musician.\\\n\n$$na_{ij} = a_i + b_i ~ LargeEnsemble_{ij} + \\epsilon_i, \\hspace{5mm} \\epsilon_{ij} \\sim N(0,\\sigma^2)$$\n\n\n::: question\nWhy is it more meaningful to use performance type for the Level One model than instrument?\n:::\n\n. . .\n\nFor now, estimate $a_i$ and $b_i$ using least-squares regression.\n\n## Level One model for one student\n\nBelow is partial data for observation #22\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n| id| diary|perform_type   |instrument            | na|\n|--:|-----:|:--------------|:---------------------|--:|\n| 22|     1|Solo           |orchestral instrument | 24|\n| 22|     2|Large Ensemble |orchestral instrument | 21|\n| 22|     3|Large Ensemble |orchestral instrument | 14|\n| 22|    13|Large Ensemble |orchestral instrument | 12|\n| 22|    14|Large Ensemble |orchestral instrument | 19|\n| 22|    15|Solo           |orchestral instrument | 25|\n:::\n:::\n\n\n## Level One model for musician 22 {.midi}\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nid_22 <- music |>\n  filter(id == 22)\n\nlinear_reg() |>\n  set_engine(\"lm\") |>\n  fit(na ~ large_ensemble, data = id_22) |>\n  tidy() |> kable(digits = 3)\n```\n\n::: {.cell-output-display}\n|term           | estimate| std.error| statistic| p.value|\n|:--------------|--------:|---------:|---------:|-------:|\n|(Intercept)    |   24.500|      1.96|    12.503|   0.000|\n|large_ensemble |   -7.833|      2.53|    -3.097|   0.009|\n:::\n:::\n\n\n## Application exercise\n\n::: appex\nüìã [AE 15: Introduction to Multilevel models](../ae/ae-15-multilevel-models.html)\n:::\n\nSee Part 3: Level One Models to fit the Level One model for all 37 musicians.\n\n## Level One model summaries\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![Recreated from BMLR Figure 8.9](24-intro-multilevel-models_files/figure-revealjs/unnamed-chunk-9-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\n. . .\n\n**Now let's consider if there is an association between the estimated slopes, estimated intercepts, and the type of instrument.**\n\n## Level Two Model\n\nThe slope and intercept for the $i^{th}$ musician can be modeled as\\\n\n$$\\begin{aligned}&a_i = \\alpha_0 + \\alpha_1 ~ Orchestra_i + u_i \\\\\n&b_i = \\beta_0 + \\beta_1 ~ Orchestra_i + v_i\\end{aligned}$$\n\nNote the response variable in the Level Two models are not observed outcomes but the (fitted) slope and intercept from each musician\n\n## Application exercise\n\n::: appex\nüìã [AE 15: Introduction to Multilevel models](../ae/ae-15-multilevel-models.html)\n:::\n\nSee Part 4: Level Two Models.\n\n## Estimated coefficients by instrument\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](24-intro-multilevel-models_files/figure-revealjs/unnamed-chunk-10-1.png){fig-align='center' width=90%}\n:::\n:::\n\n## Level Two model\n\n**Model for intercepts**\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n|term        | estimate| std.error| statistic| p.value|\n|:-----------|--------:|---------:|---------:|-------:|\n|(Intercept) |   16.283|     0.671|    24.249|   0.000|\n|orchestra   |    1.411|     0.991|     1.424|   0.163|\n:::\n:::\n\n**Model for slopes**\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n|term        | estimate| std.error| statistic| p.value|\n|:-----------|--------:|---------:|---------:|-------:|\n|(Intercept) |   -0.771|     0.851|    -0.906|   0.373|\n|orchestra   |   -1.406|     1.203|    -1.168|   0.253|\n:::\n:::\n\n## Writing out the models\n\n**Level One**\n\n\n$$\\hat{na}_{ij}  = \\hat{a}_i + \\hat{b}_i ~ LargeEnsemble_{ij}$$\n\n\nfor each musician.\n\n. . .\n\n**Level Two**\n\n```{=tex}\n\\begin{aligned}&\\hat{a}_i = 16.283 + 1.441 ~ Orchestra_i \\\\\n&\\hat{b}_i = -0.771 - 1.406 ~ Orchestra_i\\end{aligned}\n```\n## Composite model {.midi}\n\n```{=tex}\n\\begin{aligned}\\hat{na}_i &= 16.283 + 1.441 ~ Orchestra_i - 0.771 ~ LargeEnsemble_{ij} \\\\\n&- 1.406 ~ Orchestra:LargeEnsemble_{ij}\\end{aligned}\n```\n(Note that we also have the error terms $\\epsilon_{ij}, u_i, v_i$ that we will discuss next class.)\n\n::: question\n-   What is the predicted average performance anxiety before solos and small ensemble performances for vocalists and keyboardists? For those who place orchestral instruments?\n\n-   What is the predicted average performance anxiety before large ensemble performances for those who play orchestral instruments?\n:::\n\n## Disadvantages to this approach\n\n‚ö†Ô∏è Weighs each musician the same regardless of number of diary entries\n\n‚ö†Ô∏è Drops subjects who have missing values for slope (7 individuals who didn't play a large ensemble performance)\n\n‚ö†Ô∏è Does not share strength effectively across individuals.\n\n## Application exercise\n\n::: appex\nüìã [AE 15: Introduction to Multilevel models](../ae/ae-15-multilevel-models.html)\n:::\n\nSee Part 5: Distribution of $R^2$ values.\n\n## Next time\n\nWe will use a unified approach that utilizes likelihood-based methods to address some of these drawbacks.\n\n## Acknowledgements\n\n-   The content in the slides is from\n\n    -   [BMLR: Chapter 7 - Correlated data](https://bookdown.org/roback/bookdown-BeyondMLR/ch-corrdata.html)\n\n    -   [BMLR: Chapter 8 - Introduction to Multilevel Models](https://bookdown.org/roback/bookdown-BeyondMLR/ch-multilevelintro.html)\n\n-   Sadler, Michael E., and Christopher J. Miller. 2010. \"Performance Anxiety: A Longitudinal Study of the Roles of Personality and Experience in Musicians.\" Social Psychological and Personality Science 1 (3): 280--87. http://dx.doi.org/10.1177/1948550610370492.\n",
    "supporting": [
      "24-intro-multilevel-models_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/countdown-0.3.5/countdown.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/countdown-0.3.5/countdown.js\"></script>\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    function fireSlideChanged(previousSlide, currentSlide) {\n\n      // dispatch for htmlwidgets\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for reveal\n    if (window.Reveal) {\n      window.Reveal.addEventListener(\"slidechanged\", function(event) {\n        fireSlideChanged(event.previousSlide, event.currentSlide);\n      });\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}