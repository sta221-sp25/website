{
  "hash": "dd679c5f3f88b30b9d753584492d158a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"SLR: Model Assessment\"\nauthor: \"Prof. Maria Tackett\"\ndate: \"2025-01-16\"\ndate-format: \"MMM DD, YYYY\"\nfooter: \"[ðŸ”— STA 221 - Spring 2025](https://sta221-sp25.netlify.app)\"\nlogo: \"../images/logo.png\"\nformat: \n  revealjs: \n    theme: slides.scss\n    multiplex: false\n    transition: fade\n    slide-number: true\n    incremental: false \n    chalkboard: true\n    include-before: [ '<script type=\"text/x-mathjax-config\">MathJax.Hub.Config({tex2jax: {enableAssistiveMml: false}});</script>']\n  html: \n    output-file: 03-slr-model-assessment-notes.html\nhtml-math-method:\n  method: mathjax\n  url: \"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"\n\nexecute:\n  freeze: auto\n  echo: true\nknitr:\n  opts_chunk: \n    R.options:      \n    width: 200\nbibliography: references.bib\n---\n\n\n\n\n\n\n## Announcements {.midi}\n\n-   No office hours Mon, Jan 20 - Martin Luther King, Jr. Holiday\n-   Introduction to R workshops at Duke library\n    -   [Data wrangling with dplyr](https://duke.libcal.com/event/13664829) - Thu, Jan 16 at 12pm\n\n    -   [Data visualization with ggplot2](https://duke.libcal.com/event/13660125) - Thu, Jan 23 at 12pm\n\n# Questions from last class?\n\n## Topics\n\n-   Predict the response given a value of the predictor\n-   Use R to conduct exploratory data analysis and fit a model\n-   Evaluate models using RMSE and $R^2$\n-   Use analysis of variance to partition variability in the response variable\n\n## Computing set up\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# load packages\nlibrary(tidyverse)   # for data wrangling and visualization\nlibrary(tidymodels)  # for modeling (includes broom, yardstick, and other packages)\nlibrary(knitr)       # for pretty tables\nlibrary(patchwork)   # arrange plots\n\n# set default theme for ggplot2\nggplot2::theme_set(ggplot2::theme_bw())\n```\n:::\n\n\n\n\n## Data: Movie scores on Rotten Tomatoes\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](03-slr-model-assessment_files/figure-revealjs/unnamed-chunk-1-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n$$\n\\widehat{\\text{audience}} = 32.3142 + 0.5187 \\times \\text{critics} \n$$\n\n# Prediction\n\n## Making a prediction\n\nSuppose that a movie has a critics score of 70. According to this model, what is the movie's predicted audience score?\n\n\\begin{aligned}\n\\widehat{\\text{audience}} &= 32.3142 + 0.5187 \\times \\text{critics} \\\\\n&= 32.3142 + 0.5187 \\times 70 \\\\\n&= \\mathbf{68.6232}\n\\end{aligned}\n\n<br>\n\n. . .\n\n::: callout-caution\nUsing the model to predict for values outside the range of the original data is **extrapolation.** Why do we want to avoid extrapolation?\n:::\n\n# Linear regression in R\n\n## Fit the model\n\nUse the `lm()` function to fit a linear regression model\n\n<br>\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmovie_fit <- lm(audience ~ critics, data = movie_scores)\nmovie_fit\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = audience ~ critics, data = movie_scores)\n\nCoefficients:\n(Intercept)      critics  \n    32.3155       0.5187  \n```\n\n\n:::\n:::\n\n\n\n\n## Tidy results\n\nUse the `tidy()` function from the **broom** R package to \"tidy\" the model output\n\n<br>\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-line-numbers=\"|2\"}\nmovie_fit <- lm(audience ~ critics, data = movie_scores)\ntidy(movie_fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 Ã— 5\n  term        estimate std.error statistic  p.value\n  <chr>          <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)   32.3      2.34        13.8 4.03e-28\n2 critics        0.519    0.0345      15.0 2.70e-31\n```\n\n\n:::\n:::\n\n\n\n\n## Format results\n\nUse the `kable()` function from the **knitr** package to neatly format the results\n\n<br>\n\n<div>\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-line-numbers=\"|2,3\"}\nmovie_fit <- lm(audience ~ critics, data = movie_scores)\ntidy(movie_fit) |>\n  kable(digits = 3)\n```\n\n::: {.cell-output-display}\n\n\n|term        | estimate| std.error| statistic| p.value|\n|:-----------|--------:|---------:|---------:|-------:|\n|(Intercept) |   32.316|     2.343|    13.795|       0|\n|critics     |    0.519|     0.035|    15.028|       0|\n\n\n:::\n:::\n\n\n\n\n</div>\n\n## Prediction\n\nUse the `predict()` function to calculate predictions for new observations\n\n<br>\n\n**Single observation**\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nnew_movie <- tibble(critics = 70)\npredict(movie_fit, new_movie)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       1 \n68.62297 \n```\n\n\n:::\n:::\n\n\n\n\n## Prediction\n\nUse the `predict()` function to calculate predictions for new observations\n\n<br>\n\n**Multiple observations**\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmore_new_movies <- tibble(critics = c(24,70, 85))\npredict(movie_fit, more_new_movies)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       1        2        3 \n44.76379 68.62297 76.40313 \n```\n\n\n:::\n:::\n\n\n\n\n# Model assessment\n\n## Data: Life expectancy in 140 countries\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n\n\nThe data set comes from @zarulli2021 who analyze the effects of a country's healthcare expenditures and other factors on the country's life expectancy. The data are originally from the [Human Development Database](http://hdr.undp.org/en/data) and [World Health Organization](https://apps.who.int/nha/database/).\n\nThere are 140 countries (observations) in the data set.\n\n<br>\n\n**Goal: Use the income inequality in a country to understand variability in the life expectancy.**\n\n::: aside\n[Click here](https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0253450) for the original research paper.\n:::\n\n## Variables\n\n::: incremental\n-   `life_exp`: The average number of years that a newborn could expect to live, if he or she were to pass through life exposed to the sex- and age-specific death rates prevailing at the time of his or her birth, for a specific year, in a given country, territory, or geographic income_inequality. ( from the [World Health Organization](https://www.who.int/data/gho/indicator-metadata-registry/imr-details/65#:~:text=Definition%3A,%2C%20territory%2C%20or%20geographic%20area.))\n\n-   `income_inequality`: Measure of the deviation of the distribution of income among individuals or households within a country from a perfectly equal distribution. A value of 0 represents absolute equality, a value of 100 absolute inequality (Gini coefficient). (from @zarulli2021)\n:::\n\n## Univariate exploratory data analysis\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](03-slr-model-assessment_files/figure-revealjs/univariate-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n## Bivariate exploratory data analysis\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](03-slr-model-assessment_files/figure-revealjs/bivariate-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n# Application exercise\n\n::: appex\nðŸ“‹ [sta221-sp25.netlify.app/ae/ae-01-model-assessment.html](../ae/ae-01-model-assessment.html){.uri}\n\nComplete Part 1.\n:::\n\n## Clone repo + Start new RStudio project {.midi}\n\n-   Go to the course organization. Click on the repo with the prefix `ae-01`. It contains the starter documents you need to complete the AE.\n\n    -   If you do not see an `ae-01` repo, use this link to create one: <https://classroom.github.com/a/6jpkfA8n>\n\n-   Click on the green **CODE** button, select **Use SSH** (this might already be selected by default, and if it is, youâ€™ll see the text **Clone with SSH**). Click on the clipboard icon to copy the repo URL.\n\n-   In RStudio, go to *File* â†’ *New Project* â†’ *Version Control* â†’ *Git*.\n\n-   Copy and paste the URL of your assignment repo into the dialog box *Repository URL*.\n\n-   Click *Create Project*, and the files from your GitHub repo will be displayed in the *Files* pane in RStudio.\n\n-   Click `ae-01.qmd` to open the template Quarto file. This is where you will write up your code and narrative for the AE.\n\n# Model assessment\n\nWe fit a model but is it any good?\n\n## Two statistics\n\n-   **Root mean square error, RMSE**: A measure of the average error (average difference between observed and predicted values of the outcome)\n\n-   **R-squared**, $R^2$ : Percentage of variability in the outcome explained by the regression model (in the context of SLR, the predictor)\n\n. . .\n\n::: question\nWhat indicates a good model fit? Higher or lower RMSE? Higher or lower $R^2$?\n:::\n\n## RMSE\n\n$$\nRMSE = \\sqrt{\\frac{\\sum_{i=1}^n(y_i - \\hat{y}_i)^2}{n}} = \\sqrt{\\frac{\\sum_{i=1}^ne_i^2}{n}}\n$$\n\n. . .\n\n::: incremental\n-   Ranges between 0 (perfect predictor) and infinity (terrible predictor)\n\n-   Same units as the response variable\n\n-   The value of RMSE is more useful for comparing across models than evaluating a single model\n:::\n\n# ANOVA and $R^2$\n\n## ANOVA {#analysis-of-variance-anova}\n\n**Analysis of Variance (ANOVA)**: Technique to partition variability in $Y$ by the sources of variability\n\n<br>\n\n![](images/clipboard-3964457409.png)\n\n## Total variability (Response)\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](03-slr-model-assessment_files/figure-revealjs/unnamed-chunk-8-1.png){fig-align='center' width=80%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n\n|  Min| Median|  Max|   Mean| Std.Dev|\n|----:|------:|----:|------:|-------:|\n| 51.6|  72.85| 84.1| 71.614|   8.075|\n\n\n:::\n:::\n\n\n\n\n## Partition sources of variability in `life_exp`\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](03-slr-model-assessment_files/figure-revealjs/unnamed-chunk-10-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n## Total variability (Response)\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](03-slr-model-assessment_files/figure-revealjs/unnamed-chunk-11-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n$$\\text{Sum of Squares Total (SST)} = \\sum_{i=1}^n(y_i - \\bar{y})^2 = (n-1)s_y^2$$\n\n## Explained variability (Model)\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](03-slr-model-assessment_files/figure-revealjs/unnamed-chunk-12-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n$$\\text{Sum of Squares Model (SSM)} = \\sum_{i = 1}^{n}(\\hat{y}_i - \\bar{y})^2$$\n\n------------------------------------------------------------------------\n\n## Unexplained variability (Residuals)\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](03-slr-model-assessment_files/figure-revealjs/unnamed-chunk-13-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n\n$$\\text{Sum of Squares Residuals (SSR)} = \\sum_{i = 1}^{n}(y_i - \\hat{y}_i)^2$$\n\n## Sum of Squares\n\n<br>\n\n$$\n\\begin{aligned}\n\\color{#407E99}{SST} \\hspace{5mm}&= &\\color{#993399}{SSM} &\\hspace{5mm} +  &\\color{#8BB174}{SSR} \\\\[10pt]\n\\color{#407E99}{\\sum_{i=1}^n(y_i - \\bar{y})^2} \\hspace{5mm}&= &\\color{#993399}{\\sum_{i = 1}^{n}(\\hat{y}_i - \\bar{y})^2} &\\hspace{5mm}+ &\\color{#8BB174}{\\sum_{i = 1}^{n}(y_i - \\hat{y}_i)^2}\n\\end{aligned}\n$$\n\n## $R^2$\n\nThe **coefficient of determination** $R^2$ is the proportion of variation in the response, $Y$, that is explained by the regression model\n\n<br>\n\n$$\\large{R^2 = \\frac{SSM}{SST} = 1 - \\frac{SSR}{SST}}$$\n\n<br>\n\n::: question\nWhat is the range of $R^2$? Does $R^2$ have units?\n:::\n\n## Interpreting $R^2$ {.smaller}\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n\n\n::::: panel-tabset\n## Question\n\n:::: appex\nSubmit your response to the following question on Ed Discussion.\n\n<div>\n\nThe $R^2$ of the model of life expectancy and income inequality is 70%. Which of the following is the correct interpretation of this value?\n\n1.  A country's income inequality correctly predicts 70% of its life expectancy.\n2.  70% of the variability in life expectancy can be explained by income inequality.\n3.  70% of the variability in income inequality can be explained by life expectancy.\n4.  70% of the time a country's life expectancy can be predicted by its income inequality.\n\n</div>\n::::\n\n## Submit\n\n\n\n\n```{=html}\n<iframe allowfullscreen frameborder=\"0\" height=\"100%\" mozallowfullscreen style=\"min-width: 500px; min-height: 355px\" src=\"https://edstem.org/us/courses/62513/discussion/629888\" width=\"100%\"></iframe>\n```\n\n\n\n:::::\n\nðŸ”— <https://edstem.org/us/courses/62513/discussion/629888>\n\n# Using R\n\n## Augmented data frame\n\nUse the `augment()` function from the **broom** package to add columns for predicted values, residuals, and other observation-level model statistics\n\n. . .\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlife_exp_aug <- augment(life_exp_fit)\nlife_exp_aug\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 140 Ã— 8\n   life_exp income_inequality .fitted .resid    .hat .sigma   .cooksd .std.resid\n      <dbl>             <dbl>   <dbl>  <dbl>   <dbl>  <dbl>     <dbl>      <dbl>\n 1     63.8              28.2    65.8 -1.96  0.0125    4.45 0.00125       -0.444\n 2     78.2              12.2    76.9  1.29  0.0116    4.45 0.000498       0.292\n 3     59.9              32.4    62.8 -2.93  0.0193    4.44 0.00437       -0.667\n 4     76.2              14      75.7  0.542 0.00972   4.45 0.0000739      0.123\n 5     74.6               8.6    79.4 -4.82  0.0168    4.43 0.0102        -1.10 \n 6     83                 8.3    79.6  3.37  0.0173    4.44 0.00515        0.766\n 7     81.3               7.4    80.3  1.04  0.0189    4.45 0.000540       0.237\n 8     72.5              10.1    78.4 -5.88  0.0144    4.42 0.0130        -1.33 \n 9     71.8              27.6    66.2  5.62  0.0118    4.43 0.00972        1.28 \n10     74                 6.5    80.9 -6.89  0.0207    4.41 0.0260        -1.57 \n# â„¹ 130 more rows\n```\n\n\n:::\n:::\n\n\n\n\n## Finding RMSE in R\n\nUse the `rmse()` function from the **yardstick** package (part of **tidymodels**)\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrmse(life_exp_aug, truth = life_exp, estimate = .fitted)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 Ã— 3\n  .metric .estimator .estimate\n  <chr>   <chr>          <dbl>\n1 rmse    standard        4.40\n```\n\n\n:::\n:::\n\n\n\n\n## Finding $R^2$ in R\n\nUse the `rsq()` function from the **yardstick** package (part of **tidymodels**)\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrsq(life_exp_aug, truth = life_exp, estimate = .fitted)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 Ã— 3\n  .metric .estimator .estimate\n  <chr>   <chr>          <dbl>\n1 rsq     standard       0.700\n```\n\n\n:::\n:::\n\n\n\n\n<br>\n\n. . .\n\nAlternatively, use `glance()` to construct a single row summary of the model fit, including $R^2$:\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nglance(life_exp_fit)$r.squared\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.7003831\n```\n\n\n:::\n:::\n\n\n\n\n# Application exercise\n\n::: appex\nðŸ“‹ [sta221-sp25.netlify.app/ae/ae-01-model-assessment.html](../ae/ae-01-model-assessment.html){.uri}\n\nComplete Part 2.\n:::\n\n## Recap\n\n-   Used R to conduct exploratory data analysis and fit a model\n\n-   Evaluated models using RMSE and $R^2$\n\n-   Used analysis of variance to partition variability in the response variable\n\n## Next class\n\n-   Matrix representation of simple linear regression\n    -   See [Lec 04: SLR - Matrix representation prepare](../prepare/prepare-lec04.html)\n\n## References\n",
    "supporting": [
      "03-slr-model-assessment_files/figure-revealjs"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}